/*! kibana - v3.0.0milestone5 - 2014-03-13
 * Copyright (c) 2014 Rashid Khan; Licensed Apache License */

define("panels/../../../common/analytics",["require"],function(){function a(){if(b)return void 0;var a=document.createElement("script"),c=document.getElementsByTagName("script")[0];a.async=1,a.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(a,c),b=!0}var b=!1;return window.GoogleAnalyticsObject="ga",window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments)},window.ga.l=1*new Date,window.ga("create","UA-12395217-5","auto"),{track:function(){a(),window.ga.apply(null,Array.prototype.slice.call(arguments))},pageview:function(){a();var b={cookieDomain:window.location.hostname,page:window.location.pathname+window.location.hash.replace(/\?.+$/,""),location:window.location.href,dimension1:"b856ebf"};window.ga("send","pageview",b)}}}),define("factories/store",["angular","lodash"],function(a,b){var c=a.module("kibana.factories");c.factory("storeFactory",function(){return function(a,c,d){if(!b.isFunction(a.$watch))throw new TypeError("Invalid scope.");if(!b.isString(c))throw new TypeError("Invalid name, expected a string that the is unique to this store.");if(d&&!b.isPlainObject(d))throw new TypeError("Invalid defaults, expected a simple object or nothing");d=d||{};var e=localStorage.getItem(c);if(null!=e)try{e=JSON.parse(e)}catch(f){e=null}if(null==e)e=b.clone(d);else{if(!b.isPlainObject(e))throw new TypeError("Invalid store value"+e);b.defaults(e,d)}return a[c]=e,a.$watch(c,function(e){void 0===e?(localStorage.removeItem(c),a[c]=b.clone(d)):localStorage.setItem(c,JSON.stringify(e))},!0),e}})}),define("panels/marvel/cluster/module",["angular","app","kbn","lodash","../../../../../common/analytics","factories/store"],function(a,b,c,d,e){var f=a.module("kibana.panels.marvel.cluster",[]);b.useModule(f),f.controller("marvel.cluster",["$scope","$modal","$q","$http","querySrv","dashboard","filterSrv","kbnVersion","storeFactory","cacheBust",function(b,c,f,g,h,i,j,k,l,m){b.panelMeta={modals:[],editorTabs:[],status:"Experimental",description:"A simple view of cluster health<p>"};var n={title:"Cluster Status"};d.defaults(b.panel,n);var o=864e5,p=l(b,"marvelOpts",{report:!0,version:void 0,lastReport:void 0});b.init=function(){b.kbnVersion=k,(null==p.version||p.version!==k)&&b.optInModal(),b.$on("refresh",function(){b.get_data()}),b.get_data()},b.get_data=function(a,c){var e,f;b.panel.error=!1,0!==i.indices.length&&(f=d.isUndefined(a)?0:a,e=b.ejs.Request().indices(i.indices[f]),e=e.query(b.ejs.FilteredQuery(b.ejs.QueryStringQuery("_type:cluster_stats"),j.getBoolFilter(j.ids))).size(1).sort([b.ejs.Sort("@timestamp").order("desc")]),b.populate_modal(e),e.doSearch().then(function(a){return b.panelMeta.loading=!1,0===f&&(b.data=void 0,c=b.query_id=(new Date).getTime()),d.isUndefined(a.error)?void(b.query_id===c&&(b.data=d.isArray(a.hits.hits)?a.hits.hits[0]._source:void 0,q()&&r(b.data),d.isUndefined(b.data)&&f+1<i.indices.length&&b.get_data(f+1,b.query_id))):void(b.panel.error=b.parse_error(a.error))}))},b.healthClass=function(a,b){switch(a){case"green":return b?"":"text-success";case"yellow":return"text-warning";case"red":return"text-error";default:return""}},b.populate_modal=function(c){b.inspector=a.toJson(JSON.parse(c.toString()),!0)},b.setOptIn=function(a){p.version=k,p.report=a,a&&e.pageview()},b.clearMarvelStorage=function(){p.report=void 0,p.version=void 0,p.lastReport=void 0},b.optInModal=function(){var a=c({template:"./app/panels/marvel/cluster/optin.html?"+m,persist:!0,backdrop:"static",show:!1,scope:b,keyboard:!1});f.when(a).then(function(a){a.modal("show")})};var q=function(){return p.version&&p.report?null==p.lastReport?!0:(new Date).getTime()-parseInt(p.lastReport,10)>o?!0:!1:!1},r=function(a){if(b.config.stats_report_url){var c=(new Date).getTime().toString();g.post(b.config.stats_report_url,a).success(function(){p.lastReport=c})}}}]),f.filter("formatBytes",function(){return function(a){return d.isUndefined(a)?"":c.byteFormat(a)}}),f.filter("formatShort",function(){return function(a,b){return d.isUndefined(a)?"":c.shortFormat(a,b)}}),f.filter("formatNumber",function(){return function(a,b){return d.isUndefined(a)?"":a.toFixed(b)}}),f.filter("formatTime",function(){return function(a,b){if(d.isUndefined(a))return"";a/=1e3;var c="";return 3600>a?(a/=60,c=" m"):86400>a?(a/=3600,c=" h"):(a/=86400,c=" d"),a.toFixed(b)+c}})});